{% extends "base.html" %}
{% block title %}Lesson Editor | LipRead Admin{% endblock %}
{% block header %}Edit Lesson{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h5 class="mb-1">{{ lesson.title if lesson else "Lesson not found" }}</h5>
    <p class="text-muted mb-0">Update lesson metadata and objectives.</p>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="/courses/{{ course.id }}/modules/{{ module.id }}/lessons">Back to lessons</a>
    {% if lesson %}
    <a class="btn btn-outline-primary" href="/courses/{{ course.id }}/modules/{{ module.id }}/lessons/{{ lesson.id }}/activities">Activities</a>
    {% endif %}
  </div>
</div>
{% if message %}<div class="alert alert-success">{{ message }}</div>{% endif %}
{% if not lesson %}
<div class="alert alert-danger">Lesson not found.</div>
{% else %}
<div class="card shadow-sm">
  <div class="card-body">
    <form method="post" action="/courses/{{ course.id }}/modules/{{ module.id }}/lessons/{{ lesson.id }}/update">
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <label class="form-label">Title</label>
          <input type="text" name="title" class="form-control" value="{{ lesson.title }}" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Order</label>
          <input type="number" name="order" class="form-control" value="{{ lesson.order }}" min="0">
        </div>
        <div class="col-md-3">
          <label class="form-label">Estimated Minutes</label>
          <input type="number" name="estimatedMin" class="form-control" value="{{ lesson.estimatedMin }}" min="0">
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Objectives (one per line)</label>
        <textarea name="objectives" class="form-control" rows="4">{{ lesson.objectives|join('\n') }}</textarea>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          <div>Created: {{ lesson.createdAt }}</div>
          <div>Updated: {{ lesson.updatedAt }}</div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary" type="submit">Save Changes</button>
        </div>
      </div>
    </form>
    <form class="mt-3" method="post" action="/courses/{{ course.id }}/modules/{{ module.id }}/lessons/{{ lesson.id }}/delete" onsubmit="return confirm('Delete this lesson? This will also remove its activities.')">
      <button class="btn btn-outline-danger" type="submit">Delete Lesson</button>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}
