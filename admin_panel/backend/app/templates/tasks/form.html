{% extends "base.html" %}
{% block title %}{{ 'Edit' if task else 'New' }} Task | LipRead Admin{% endblock %}
{% block header %}{{ 'Edit' if task else 'New' }} Task{% endblock %}
{% block content %}
<div class="card shadow-sm">
    <div class="card-body">
        {% if errors %}
        <div class="alert alert-danger">
            <ul class="mb-0">
                {% for err in errors %}<li>{{ err }}</li>{% endfor %}
            </ul>
        </div>
        {% endif %}
        <form class="row g-3" method="post" action="{{ '/admin/tasks/' + task.id + '/update' if task and task.id else '/admin/tasks' }}">
            <div class="col-md-6">
                <label class="form-label">Title</label>
                <input type="text" class="form-control" name="title" value="{{ task.title if task else '' }}" required>
            </div>
            <div class="col-md-3">
                <label class="form-label">Points (XP)</label>
                <input type="number" class="form-control" name="points" min="0" value="{{ task.points if task else 0 }}" required>
            </div>
            <div class="col-md-3">
                <label class="form-label">Frequency</label>
                <select class="form-select" name="frequency" required>
                    <option value="daily" {% if task and task.frequency=='daily' or not task %}selected{% endif %}>Daily</option>
                    <option value="weekly" {% if task and task.frequency=='weekly' %}selected{% endif %}>Weekly</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Action type</label>
                <select class="form-select" name="action_type" required>
                    <option value="">Select an action</option>
                    {% for key, label in actions.items() %}
                        <option value="{{ key }}" {% if task and task.action and (task.action.type if task.action is mapping else task.action)==key %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <div class="form-text">Determines which in-app activity moves this task forward.</div>
            </div>
            <div class="col-md-2">
                <label class="form-label">Count</label>
                <input type="number" class="form-control" name="action_count" min="1" value="{{ task.action.count if task and task.action is mapping and task.action.count is defined else 1 }}" required>
                <div class="form-text">How many times the action must be done per period.</div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">{{ 'Update task' if task else 'Create task' }}</button>
                <a href="/admin/tasks" class="btn btn-outline-secondary">Back</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
